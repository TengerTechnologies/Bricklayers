# Bricklayers: G-code Post-Processor for Z-Shifting and Extrusion Adjustment

## Description

Bricklayers is a Python script designed to post-process G-code files generated by 3D printer slicers. It specifically targets the adjustment of Z-heights for certain perimeter blocks and modifies extrusion values, with a focus on enhancing the quality of the first and last layers of a 3D print. By intelligently manipulating the G-code, Bricklayers aims to improve the structural integrity and visual appeal of printed objects.

## Installation

Bricklayers is compatible with PrusaSlicer and OrcaSlicer. To use it, you need to have Python 3 installed on your system.

1. **Find your Python path:**
    -   Open the Command Prompt (cmd).
    -   Run the command `where python`.
    -   This will output the path to your Python executable. For example: `C:\Users\USER\AppData\Local\Programs\Python\Python313\python.exe`

2. **Download the script:**
    -   Download the `bricklayers.py` script from this repository.
    -   Save it to a known location on your computer (e.g., `C:\Users\USER\Documents\Bricklayers\bricklayers.py`).

## Usage

**Manual Usage:**

To use Bricklayers manually, run the script from the command line with the following arguments:

```bash
python bricklayers.py input_file [-layerHeight value] [-extrusionMultiplier value]
```

-   `input_file`: Path to the input G-code file you want to process. (Required)
-   `-layerHeight`: Specifies the layer height in mm. Default is 0.2mm. (Optional)
-   `-extrusionMultiplier`: Sets the extrusion multiplier for the first layer. Default is 1.5x. (Optional)

### Example

```bash
python bricklayers.py my_print.gcode -layerHeight 0.12 -extrusionMultiplier 1.2
```

**PrusaSlicer and OrcaSlicer Setup:**

To use Bricklayers with PrusaSlicer or OrcaSlicer, you need to configure it as a post-processing script:

1. Go to Post-processing section:
   - **PrusaSlicer**: Go to **Print Settings > Output options**.
   - **OrcaSlicer**: Go to **Process > Others**.
2. In the **Post-processing scripts** section, add the following command:

    ```
    "python_path" "script_path" -layerHeight [value] -extrusionMultiplier [value]
    ```

    -   Replace `"python_path"` with the path to your Python executable (e.g., `"C:\Users\USER\AppData\Local\Programs\Python\Python313\python.exe"`).
    -   Replace `"script_path"` with the path to the `bricklayers.py` script (e.g., `"C:\Users\USER\Documents\Bricklayers\bricklayers.py"`).
    -   Replace layerHeight's `[value]` with the layer height you've set in the slicer settings.
    -   Replace extrusionMultiplier's `[value]` with the extrusion multiplier for the first layer.

After slicing and saving your G-code file, the script will run automatically.

## How It Works

Bricklayers processes the G-code file line by line, performing the following operations:

1. **Layer Detection**: It detects layer changes by identifying `G1 Z` commands, which indicate a new layer.
2. **Perimeter Type Identification**: It recognizes different types of perimeters (external, internal) based on comments inserted by slicers (e.g., `;TYPE:External perimeter`).
3. **Perimeter Block Grouping**: It groups G-code lines into perimeter blocks, particularly for internal perimeters. Each block is a set of consecutive extrusion commands.
4. **Z-Shifting**: For odd-numbered internal perimeter blocks, it applies a Z-shift by inserting a `G1 Z` command with an adjusted Z-height. The shift amount is half the layer height. Even-numbered blocks are reset to the true layer height.
5. **Extrusion Adjustment**:
    -   For the first layer, it multiplies the extrusion value (`E`) by 1.5 for shifted blocks.
    -   For the last layer, it multiplies the extrusion value by 0.5 for shifted blocks.
    -   For other layers, it multiplies the extrusion value by the `extrusionMultiplier` provided as a command-line argument.

## Logging

Bricklayers logs its operations to a file named `z_shift_log.txt`, located in the same directory as the script. The log includes information about the processing steps, such as layer detection, perimeter type identification, Z-shifting, and extrusion adjustments.

## Contributing

We welcome contributions to the Bricklayers project! If you'd like to contribute, please follow these steps:

1. Fork the repository on GitHub.
2. Create a new branch for your feature or bug fix: `git checkout -b feature/your-feature-name` or `git checkout -b bugfix/your-bugfix-name`.
3. Make your changes and commit them with clear, descriptive commit messages.
4. Push your branch to your forked repository: `git push origin your-branch-name`.
5. Create a pull request from your branch to the main branch of the original Bricklayers repository.

Please ensure your code adheres to the project's coding style and conventions.

While there isn't a specific code of conduct file in this project, we expect all contributors to follow common open-source community guidelines and treat each other with respect.

## Copyright and License

Copyright (c) \[2025] \[Roman Tenger].

This project is licensed under the GNU General Public License version 3 (GPLv3). See the [LICENSE](LICENSE) file for the full license text. For more details see the [GNU website](https://www.gnu.org/licenses/gpl-3.0.en.html).
