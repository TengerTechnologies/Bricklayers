# Brick Layers for PrusaSlicer and OrcaSlicer

Brick Layers is a Python script designed to post-process G-code files generated by 3D printer slicers. It interlocks print layers to improve directional strength and offers options to adjust Z-heights and extrusion values. Inspired by a method tested by Stefan from CNC Kitchen, Brick Layers enhances both the structural integrity and visual appeal of printed objects.

## Features
- Interlocks print layers for improved directional strength.
- Adjusts Z-heights and extrusion values for enhanced print quality.
- Optional extrusion multiplier for shifted layers.
- Compatible with PrusaSlicer and OrcaSlicer.
- Easy installation and usage.

## Description
Brick Layers processes G-code files line by line, performing the following operations:

1. **Layer Detection**: Identifies layer changes by detecting `G1 Z` commands.
2. **Perimeter Type Identification**: Recognizes perimeter types (e.g., external, internal) from slicer comments such as `;TYPE:External perimeter`.
3. **Perimeter Block Grouping**: Groups G-code lines into blocks of internal perimeters.
4. **Z-Shifting**: Shifts odd-numbered internal perimeter blocks by half the layer height and resets even-numbered blocks to the true layer height.
5. **Extrusion Adjustment**:
    - Multiplies extrusion values (`E`) by 1.5 for shifted blocks on the first layer.
    - Applies a multiplier of 0.5 for shifted blocks on the last layer.
    - Applies the user-defined extrusion multiplier to other layers.

## Setup
Brick Layers is needs python installed (https://www.python.org/downloads/) and you need to download the `bricklayers.py` script from this repository.

### Usage from inside PrusaSlicer and OrcaSlicer

To use Brick Layers in PrusaSlicer or OrcaSlicer, configure it as a post-processing script:

1. **Access the post-processing section:**
    - **PrusaSlicer**: Go to **Print Settings > Output options**.
    - **OrcaSlicer**: Go to **Process > Others > Post-proccessing Script**.
      
2. **Add the following command in the Post-processing scripts section:**

    ```
    "python_path" "script_path" -layerHeight [value] -extrusionMultiplier [value]
    ```
    - Replace `"python_path"` with the path to your Python executable.
      You can get the path from right clicking your Python executable and clicking "Copy as Path"
    - Replace `"script_path"` with the path to the `bricklayers.py` script.
      You can get the path from right clicking `bricklayers.py` and clicking "Copy as Path"
    - Replace `[value]` for `-layerHeight` and `-extrusionMultiplier` with your desired values.
      Note: -layerHeight value must be the layer height you sliced your file with.
      
You can also find your Python Path by...
    - opening the Command Prompt (cmd).
    - Run the command `where python`.
    - This will output the path to your Python executable. For example: `C:\Users\USERNAME\AppData\Local\Programs\Python\Python313\python.exe`

After slicing and saving your G-code file, the script will run automatically.

To then veiw the new G-code, you must take the new file and import it into the slicer or drag and drop it into the slicer.

### Manual Usage
To use Brick Layers manually, run the script from the command line with the following arguments:

```bash
python bricklayers.py input_file [-layerHeight value] [-extrusionMultiplier value]
```

- `input_file`: Path to the input G-code file you want to process. (Required)
- `-layerHeight`: Specifies the layer height in mm. Default is 0.2mm. (Optional)
- `-extrusionMultiplier`: Sets the extrusion multiplier for the first layer. Default is 1.5x. (Optional)

#### Example

```bash
python bricklayers.py my_print.gcode -layerHeight 0.12 -extrusionMultiplier 1.2
```

## Logging
Brick Layers logs its operations to a file named `z_shift_log.txt`, located in the same directory as the script. The log includes details about layer detection, perimeter identification, Z-shifting, and extrusion adjustments.

## Limitations
- Currently works only with relative extrusions and absolute positions (default for most printers).
- Issues with multiple top layers: Line height is only compensated for the first and last layers. A fix is planned in future updates.

## Contributing
We welcome contributions! Please follow these steps:

1. Fork the repository on GitHub.
2. Create a new branch for your feature or bug fix:
   ```
   git checkout -b feature/your-feature-name
   ```
3. Make your changes and commit them with clear, descriptive commit messages.
4. Push your branch to your forked repository:
   ```
   git push origin your-branch-name
   ```
5. Create a pull request to the main branch of the original repository.

Please ensure your code adheres to the project’s coding style and conventions.

## Future Development
Planned improvements include:
- Fixing top-layer compensation for multiple layers.
- Enhancing compatibility with various printer configurations.

## Support
If you enjoy this project, consider supporting it by:
- Liking and commenting on the associated video.
- Subscribing for updates on further developments.

For additional context, check out:
- [Stefan's CNC Kitchen video](https://www.youtube.com/watch?v=5hGm6cubFVs&t=600s))
- [Geek Dour’s video on patents](https://www.youtube.com/watch?v=9IdNA_hWiyE&t=28s)

## Copyright and License
Copyright (c) 2025 Roman Tenger.

This project is licensed under the GNU General Public License version 3 (GPLv3). See the [LICENSE](LICENSE) file for the full license text. For more details, see the [GNU website](https://www.gnu.org/licenses/gpl-3.0.en.html).

Have fun with the script and happy printing!

